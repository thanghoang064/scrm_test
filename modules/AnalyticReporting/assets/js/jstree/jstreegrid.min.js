!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):e(jQuery)}(function(e){var t=/^\s*$/g,i=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,r="data-jstreegrid",s="data-jstreegrid-column",n="jstree-search",d=!1,a=function(e,t){return"jstree_"+e+"_grid_"+(t||"").replace(i,"\\$&")+"_col"},o=function(t){return e.makeArray(t.map(function(){return this.id}))},l=function(t,i,r,s){if(void 0==s&&(s=e()),null===i||void 0===i||0===i.length)return s;var n,d=e(),o=[].concat(r);return"string"==typeof i?(n=a(t,i),d=o.map(function(e){return"#"+n+e}).join(", ")):(d=[],i.forEach(function(e,i){var r=a(t,e);d=d.concat(o.map(function(e){return"#"+r+e}))}),d=d.join(", ")),1==o.length?s.find(d):e(d)},h=!1,c=null,g=0,u=0,p=/<\/?[^>]+>/gi,f=function(t,i,r,s,n){var d,a;if(s.data=e.extend(!0,{},i.data),i&&i.children_d&&n)for(d=0,a=i.children_d.length;d<a;d++)f(t,t.get_node(i.children_d[d]),r,r.get_node(s.children_d[d]),n)},m=function(e,t){var i=e.get_node(t),r=i.children;return!r||r.length<=0||!i.state.opened?t:m(e,r[r.length-1])},v=function(e,t){return void 0!==e&&null!==e?"function"==typeof e?e(t):null!==t.data&&void 0!==t.data&&void 0!==t.data[e]?t.data[e]:"":""};e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(i,_){function j(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}this._initialize=function(){if(!this._initialized){var t=this.settings.grid||{},i=this.element,r=this._gridSettings={columns:t.columns||[],treeClass:"jstree-grid-col-0",context:t.contextmenu||!1,columnWidth:t.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:t.resizable,draggable:t.draggable,stateful:t.stateful,indent:0,sortOrder:"text",sortAsc:!0,caseInsensitive:t.caseInsensitive,fixedHeader:!1!==t.fixedHeader,width:t.width,height:t.height,gridcontextmenu:t.gridcontextmenu,treecol:0,gridcols:[]},s=r.columns,n=0,a=!1;!0===r.gridcontextmenu?r.gridcontextmenu=function(e,t,i,r,s,n,d){return{edit:{label:"Edit",action:function(t){var r=n.get_node(i);e._edit(r,s,d)}}}}:!1===r.gridcontextmenu&&(r.gridcontextmenu=!1);for(var o=0,l=t.columns.length;o<l;o++)t.columns[o].tree?(n=o,r.treecol=n):r.gridcols.push(o);if(this.uniq=Math.ceil(1e3*Math.random()),this.rootid=i.attr("id"),/msie/.test(navigator.userAgent.toLowerCase()))parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(r.defaultConf.display="inline",r.defaultConf.zoom="1");d||(d=!0,e('<style type="text/css">'+[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:absolute; top:0; right:0; height:24px; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px; cursor: default;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {position:relative; background-color: #EBF3FD; z-index: 1;}",".jstree-grid-hidden {display: none;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {table-layout: fixed; width: 100%; overflow: auto; position: relative;}",".jstree-grid-midwrapper {display: table-row;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-ellipsis {text-overflow: ellipsis;}",".jstree-grid-col-0 {width: 100%;}"].join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").insertAfter(i),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),t.width&&this.gridWrapper.width(t.width),t.height&&this.gridWrapper.height(t.height);for(o=0,l=s.length;o<l;o++)e("<div></div>").addClass("jstree-default jstree-grid-column jstree-grid-column-"+o+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+n+")").append(i),i.addClass("jstree-grid-cell"),r.fixedHeader&&this.gridWrapper.scroll(function(){e(this).find(".jstree-grid-header").css("top",e(this).scrollTop())});var h,c,g=e.proxy(this.settings.sort,this);if(this.settings.sort=function(e,t){var i,s=this.colrefs;if("text"===r.sortOrder){var n=this.get_text(e).toLowerCase().localeCompare(this.get_text(t).toLowerCase());i=r.caseInsensitive?1===n:1===g(e,t)}else{var d=this.get_node(e),a=this.get_node(t),o=s[r.sortOrder].value,l="function"==typeof o?o(d):d.data[o],h="function"==typeof o?o(a):a.data[o];void 0!==h&&(i=r.caseInsensitive?l.toLowerCase()>h.toLowerCase():l>h)}return r.sortAsc||(i=!i),i?1:-1},r.draggable)if(e.ui&&e.ui.sortable)e(this.midWrapper).sortable({axis:"x",handle:".jstree-grid-header",cancel:".jstree-grid-separator",start:function(e,t){h=t.item.index()},stop:function(e,t){c=t.item.index(),r.columns.splice(c,0,r.columns.splice(h,1)[0])}});else console.warn("[jstree-grid] draggable option requires jQuery UI");this.searchColumn=function(e){var t={};if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&i%1==0&&i<s.length&&i>=0&&(t[i]=e[i]);a=t,0!==Object.keys(t).length?this.search("someValue"):this.search(""),a=!1};for(o=0,l=s.length;o<l;o++){var u=s[o];"function"!=typeof u.search_callback&&(u.search_callback=function(t,i,r,s){return new e.vakata.search(t,!0,{caseSensitive:p.case_sensitive,fuzzy:p.fuzzy}).search(i).isMatch})}var p=this.settings.search,f=p.search_callback;f||(f=function(t,i){var r,d=new e.vakata.search(t,!0,{caseSensitive:p.case_sensitive,fuzzy:p.fuzzy}),a=d.search(i.text).isMatch;if(!a)for(var o=0,l=s.length;o<l&&!(n!==o&&(r=s[o],a=d.search(v(r.value,i)).isMatch));o++);return a}),p.search_callback=function(e,t){var r=!1;if(a){for(var d in a)if(a.hasOwnProperty(d)){var o=a[d];if(""==o)continue;var l=s[d];if(!(r=n==d?l.search_callback(o,t.text,t,l):l.search_callback(o,v(l.value,t),t,l)))break}i.trigger("columnSearch_grid.jstree")}else r=f(e,t),i.trigger("omniSearch_grid.jstree");return r},this._initialized=!0}},this.init=function(e,t){_.init.call(this,e,t),this._initialize()},this.bind=function(){_.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0),r=j();this._detachColumns(r),this._prepare_grid(i),this._reattachColumns(r)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){this.gridWrapper;var i=[t.node.id];t.node&&t.node.children_d&&(i=i.concat(t.node.children_d)),l(this.uniq,i,this._gridSettings.gridcols).remove()}},this)).on("show_node.jstree",e.proxy(function(e,t){this._hideOrShowTree(t.node,!1)},this)).on("hide_node.jstree",e.proxy(function(e,t){this._hideOrShowTree(t.node,!0)},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r,s=this.element.find("[class~='jstree-anchor']:first").outerHeight(),n=this.element.attr("class")||"";e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+s+"px; height: "+s+"px;}</style>").appendTo("head"),r=n.split(/\s+/).map(function(e){return e.match(/^jstree(-|$)/)?"":e}),this.gridWrapper.addClass(r.join(" "))},this)).on("move_node.jstree",e.proxy(function(t,i){i.new_instance.element.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&l(this.uniq,this._hover_node,this._gridSettings.gridcols).removeClass("jstree-hovered"),this._hover_node=r,l(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,l(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;l(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;l(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r=t.node||[];l(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(t,i){var r,s,d=this.gridWrapper,a=this,h=(new Date).getTime(),c=o(i.nodes.filter(".jstree-node"));if(this.holdingCells={},i.nodes.length){var g=j(),u=d.find("div.jstree-grid-cell-regular");this._detachColumns(g),this._data.search.som&&(this._data.search.smc&&(r=i.nodes.add(i.nodes.find(".jstree-node"))),r=(r||i.nodes).add(i.nodes.parentsUntil(".jstree")),u.hide(),r.filter(".jstree-node").each(function(t,i){var r=i.id;if(r){a._prepare_grid(i);t=0;for(var s=a._gridSettings.gridcols.length;t<s;t++)t!==a._gridSettings.treecol&&l(a.uniq,r,a._gridSettings.gridcols[t],e(a._domManipulation.columns[t])).show()}}));for(var p=0,f=this._gridSettings.gridcols.length;p<f;p++)p!==this._gridSettings.treecol&&l(a.uniq,c,this._gridSettings.gridcols[p],e(this._domManipulation.columns[p])).addClass(n);this._reattachColumns(g),s=(new Date).getTime(),this.element.trigger("search-complete.jstree-grid",[{time:s-h}])}return!0},this)).on("clear_search.jstree",e.proxy(function(e,t){var i=this.gridWrapper,r=o(t.nodes.filter(".jstree-node"));return i.find("div.jstree-grid-cell").show(),l(this.uniq,r,this._gridSettings.gridcols).removeClass(n),!0},this)).on("copy_node.jstree",function(e,t){var i=t.new_instance,r=t.old_instance,s=i.get_node(t.node,!0);return f(r,t.original,i,t.node,!0),i._detachColumns(s.id),i._prepare_grid(s),i._reattachColumns(s.id),!0}).on("show_ellipsis.jstree",e.proxy(function(e,t){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).addClass("jstree-grid-ellipsis"),!0},this)).on("hide_ellipsis.jstree",e.proxy(function(e,t){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).removeClass("jstree-grid-ellipsis"),!0},this)).on("enable_node.jstree",e.proxy(function(e,t){var i=t.node.id;l(this.uniq,i,this._gridSettings.gridcols).removeClass("jstree-disabled"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").removeClass("jstree-disabled")},this)).on("disable_node.jstree",e.proxy(function(e,t){var i=t.node.id;l(this.uniq,i,this._gridSettings.gridcols).addClass("jstree-disabled"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-disabled")},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-hover")},this)),this._gridSettings.stateful&&this.element.on("resize_column.jstree-grid",e.proxy(function(e,t,i){localStorage["jstree-root-"+this.rootid+"-column-"+t]=i},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),_.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?l(this.uniq,t,this._gridSettings.gridcols).remove():i.find("div.jstree-grid-cell-regular").remove()},this._prepare_headers=function(){var t,i,r,n,d,a,o,l,p=this,f=this._gridSettings,m=f.columns||[],v=f.columnWidth,_=f.resizable||!1,j=f.isThemeroller,w=j?"themeroller":"regular",x=!1,C=this.gridparent,y=this.rootid,b=f.defaultConf;this.parent=C,this.colrefs={};for(var S=0,W=m.length;S<W;S++){r=m[S].headerClass||"",n=m[S].columnClass||"",d=m[S].header||"";do{l=String(Math.floor(1e4*Math.random()))}while(void 0!==this.colrefs[l]);a=m[S].value?l:"text",this.colrefs[a]=m[S],d&&(x=!0),i=f.stateful&&localStorage["jstree-root-"+y+"-column-"+S]?localStorage["jstree-root-"+y+"-column-"+S]:m[S].width||v;var k=m[S].minWidth||i,M=m[S].maxWidth||i;"auto"!==i&&"string"!=typeof i&&(i-=j?7:10),t=this.midWrapper.children("div.jstree-grid-column-"+S),(o=e("<div></div>").css(b).addClass("jstree-grid-div-"+this.uniq+"-"+S+" "+(j?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+w+" "+r+" "+n).html(d)).addClass((j?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+w),!0===this.settings.core.themes.ellipsis&&o.addClass("jstree-grid-ellipsis"),o.prependTo(t),o.attr(s,a),o.outerWidth(),e("<div class='jstree-grid-separator jstree-grid-separator-"+w+(j?" ui-widget-header":"")+(_?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(o),t.width(i),t.css("min-width",k),t.css("max-width",M)}o.addClass((j?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+w),void 0===m[m.length-1].width&&(i,t.css({width:"auto"}),o.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),x?f.header=void 0:e("div.jstree-grid-header").hide(),!this.bound&&_&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s;h&&(s=c.prevAll(".jstree-grid-column").length,r=c.closest(".jstree-grid-wrapper").find(".jstree"),(t=e.jstree.reference(r)).settings.grid.columns,c.parent().children("div.jstree-grid-column"),(isNaN(s)||s<0)&&(t._gridSettings.treeWidthDiff=r.find("ins:eq(0)").width()+r.find("[class~='jstree-anchor']:eq(0)").width()-t._gridSettings.columns[0].width),i=t._gridSettings.columns[s].width=parseFloat(c.css("width")),h=!1,c=null,r.trigger("resize_column.jstree-grid",[s,i]))}).mousemove(function(e){if(h){var t,i,r,s=(u=e.pageX)-g;0!==s&&(t=c.width(),(i=parseFloat(c.css("width")))||(i=c.innerWidth()),r=i+(s=s<0?Math.max(s,-t):s),(s>0||t>0)&&r>10&&(c.width(r+"px"),c.css("min-width",r+"px"),c.css("max-width",r+"px"),g=u))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return h=!0,g=t.pageX,c=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this).closest("div.jstree-grid-column"),n=parseFloat(s.css("width")),d=0,a=s.prevAll(".jstree-grid-column").length,o=s.width();s.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>d&&(d=t)}),r=n+(i=(i=d-n)<0?Math.max(i,-o):i)+"px",s.width(r),s.css("min-width",r),s.css("max-width",r),e(this).closest(".jstree-grid-wrapper").find(".jstree").trigger("resize_column.jstree-grid",[a,r])}).on("click",".jstree-grid-separator",function(e){e.stopPropagation()})),this.gridWrapper.on("click",".jstree-grid-header-cell",function(t){if(p.sort){var i,r=e(this).attr(s);f.sortOrder===r&&!0===f.sortAsc?(f.sortAsc=!1,i="&darr;"):(f.sortOrder=r,f.sortAsc=!0,i="&uarr;"),e(this.closest(".jstree-grid-wrapper")).find(".jstree-grid-sort-icon").remove(),e("<span></span>").addClass("jstree-grid-sort-icon").appendTo(e(this)).html(i);var n=p.get_node("#");p.sort(n,!0),p.redraw_node(n,!0)}})},this._domManipulation=null,this._detachColumns=function(e){if(null==this._domManipulation){var t=this._gridSettings.columns||[],i=(this._gridSettings.treecol,this.midWrapper);this._domManipulation={id:e,columns:{}};for(var r=0,s=t.length;r<s;r++)this._domManipulation.columns[r]=i.children(".jstree-grid-column-"+r)[0],this._domManipulation.columns[r].parentNode.removeChild(this._domManipulation.columns[r])}return this._domManipulation},this._reattachColumns=function(e){if(null==this._domManipulation)return!1;if(this._domManipulation.id===e){for(var t=this._gridSettings.columns||[],i=(this._gridSettings.treecol,this.midWrapper),r=0,s=t.length;r<s;r++)i[0].appendChild(this._domManipulation.columns[r]);this._domManipulation=null}return!0},this.open_node=function(t,i,r){var s=e.isArray(t),n=null;if(s||"#"!==(n=this.get_node(t)).id){var d=s?j():n.id;this._detachColumns(d);var a=_.open_node.call(this,t,i,r);return this._reattachColumns(d),a}},this.redraw_node=function(t,i,r,s){var n=e.isArray(t)?j():this.get_node(t).id;return this._detachColumns(n),(t=_.redraw_node.call(this,t,i,r,s))&&this._prepare_grid(t),this._reattachColumns(n),t},this.refresh=function(){return this._clean_grid(),_.refresh.apply(this,arguments)},this.set_id=function(t,i){var s,n=this.uniq;t&&(s=t.id);var d=_.set_id.apply(this,arguments);if(d&&void 0!==s){this.gridWrapper;var o=[s];t&&t.children_d&&(o=o.concat(t.children_d)),l(n,o,this._gridSettings.gridcols).attr(r,t.id).removeClass(a(n,s)).addClass(a(n,t.id)).each(function(i,r){e(r).attr("id",a(n,t.id)+(i+1))})}return d},this._hideOrShowTree=function(e,t){this._detachColumns(e.id),this._hideOrShowNode(e,t,this._gridSettings.columns||[],this._gridSettings.treecol),this._reattachColumns(e.id)},this._hideOrShowNode=function(t,i,r,s){for(var n=0,d=r.length;n<d;n++)if(n!==s){var a=l(this.uniq,t.id,n,e(this._domManipulation.columns[n]));i?a.addClass("jstree-grid-hidden"):a.removeClass("jstree-grid-hidden")}if(t.state.opened&&t.children)for(n=0,d=t.children.length;n<d;n++)this._hideOrShowNode(this.get_node(t.children[n]),i,r,s)},this._hide_grid=function(t){if(!t)return!0;this._detachColumns(t.id);for(var i=t.children?t.children:[],r=this._gridSettings.columns||[],s=this._gridSettings.treecol,n=0,d=i.length;n<d;n++){for(var a=this.get_node(i[n]),o=0,h=r.length;o<h;o++)o!==s&&l(this.uniq,a.id,o,e(this._domManipulation.columns[o])).remove();a.state.opened&&this._hide_grid(a)}this._reattachColumns(t.id)},this.holdingCells={},this.getHoldingCells=function(t,i,r){if(t.state.hidden||!t.state.opened)return e();var s,n,d=e(),o=t.children||[],l=this.uniq;for(n=0;n<o.length;n++)r[s=a(l,o[n])+i]&&(d=d.add(r[s]).add(this.getHoldingCells(this.get_node(o[n]),i,r)));return d},this._edit=function(t,i,r){if(!t)return!1;if(t.data||(t.data={}),!r)return!1;"div"===(r=e(r)).prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,n=this.element.width(),d=t.data[i.value],a=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),o=e("<input />",{value:d,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=o.val();if(""===e||e===d)e=d;else{t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:d});var s=j();this._detachColumns(s),this._prepare_grid(this.get_node(t,!0)),this._reattachColumns(s)}o.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){o.width(Math.min(a.text("pW"+this.value).width(),n))},keypress:function(e){if(13===e.which)return!1}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(o),o.css(l).width(Math.min(a.text("pW"+o[0].value).width(),n))[0].select()},this.grid_hide_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).hide()},this.grid_show_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).show()},this._prepare_grid=function(i){var s,d,o,h,c,g,u,f,_,j,w,x,C,y,b,S,W,k,M,z,q,A,T,O,P,N,L,D,I,V,F,H,B,E=this._gridSettings,U=E.treeClass,$=this,Q=E.columns||[],X=E.isThemeroller,Y=this.uniq,G=E.treecol,J=this.element,K=this.rootid,R=X?"themeroller":"regular",Z=this.get_node(i),ee=E.columnWidth,te=E.defaultConf,ie=function(t,i,r,s,n){return function(n){var d=jQuery.Event("select_cell.jstree-grid");t.trigger(d,[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}]),d.isDefaultPrevented()||i.children(".jstree-anchor").trigger("click.jstree",n)}},re=function(t,i,r,s,n){return function(d){E.gridcontextmenu&&(d.preventDefault(),e.vakata.context.show(this,{x:d.pageX,y:d.pageY},E.gridcontextmenu($,t,i,r,s,n,d.target)))}},se=function(e,t){return function(){t.hover_node(e)}},ne=function(e,t){return function(){t.dehover_node(e)}},de=this.midWrapper,ae=Z.id,oe=this.get_node(Z.parent).children,le=e.inArray(ae,oe),he=this.holdingCells,ce=!1;if(N=(u=(s=e(i)).children("[class~='jstree-anchor']")).hasClass(n),L=u.hasClass("jstree-clicked"),1===u.length){!Z.state.opened,y=a(Y,ae),b="#"===Z.parent?null:Z.parent,u.addClass(U),I=s,V=$,H=(D=u).hasClass("jstree-anchor")?D:D.children("[class~='jstree-anchor']"),B=V.settings.grid.columns[0],F="",B.title&&("_DATA_"===B.title?F=V.get_text(I):I.attr(B.title)&&(F=I.attr(B.title))),(F=F.replace(p,""))&&H.attr("title",F),f=u,k=le<=0?Z.parent:m(this,oe[le-1]),z=le>=oe.length-1?"NULL":oe[le+1],A=Z.children&&Z.children.length>0?Z.children[0]:"NULL";this.settings.grid;for(var ge=0,ue=Q.length;ge<ue;ge++)if(G!==ge){if(T=Q[ge],P=null==this._domManipulation?de.children("div:eq("+ge+")"):e(this._domManipulation.columns[ge]),h=T.cellClass||"",c=T.wideCellClass||"",g=T.columnClass||"",P.addClass(g),o=v(T.value,Z),"function"==typeof T.format&&(o=T.format(o)),T.images?(d=T.images[o]||T.images.default)&&(O="*"===d[0]?'<span class="'+d.substr(1)+'"></span>':'<img src="'+d+'">'):O=o,(void 0===O||null===O||t.test(O))&&(O="&nbsp;"),(_=T.valueClass&&null!==Z.data&&void 0!==Z.data?Z.data[T.valueClass]||"":"")&&T.valueClassPrefix&&""!==T.valueClassPrefix&&(_=T.valueClassPrefix+_),(j=T.wideValueClass&&null!==Z.data&&void 0!==Z.data?Z.data[T.wideValueClass]||"":"")&&T.wideValueClassPrefix&&""!==T.wideValueClassPrefix&&(j=T.wideValueClassPrefix+j),C=(C=T.title&&null!==Z.data&&void 0!==Z.data?Z.data[T.title]||"":"").replace(p,""),x=7,"auto"!==(T.width||ee)&&x,(!(f=l(Y,ae,ge,P))||f.length<1)&&(f=e("<div></div>"),e("<span></span>").appendTo(f),f.attr("id",y+ge),f.addClass(y),f.attr(r,ae),N?f.addClass(n):f.removeClass(n),L?f.addClass("jstree-clicked"):f.removeClass("jstree-clicked"),!0===this.settings.core.themes.ellipsis&&ge!==G&&f.addClass("jstree-grid-ellipsis")),Z.state.hidden?f.addClass("jstree-grid-hidden"):f.removeClass("jstree-grid-hidden"),Z.state.disabled?f.addClass("jstree-disabled"):f.removeClass("jstree-disabled"),W=l(Y,k,ge,P),M=l(Y,z,ge,P),q=l(Y,A,ge,P),S=l(Y,b,ge,P),b?(S&&S.length>0?(W&&W.length>0?f.insertAfter(W):q&&q.length>0?f.insertBefore(q):M&&M.length>0?f.insertBefore(M):f.insertAfter(S),ce=!0):ce=!1,he[y+ge]=f):(W&&W.length>0?f.insertAfter(W):q&&q.length>0?f.insertBefore(q):M&&M.length>0?f.insertBefore(M):f.appendTo(P),ce=!0),ce){var pe=this.getHoldingCells(Z,ge,he);f.after(pe)}(w=f.children("span")).addClass(h+" "+_).html(O),(f=f.css(te).addClass("jstree-grid-cell jstree-grid-cell-regular jstree-grid-cell-root-"+K+" jstree-grid-cell-"+R+" "+c+" "+j+(X?" ui-state-default":"")).addClass("jstree-grid-col-"+ge).addClass("jstree-animated")).click(ie(J,s,o,T)),f.on("contextmenu",re(J,s,o,T,this)),f.hover(se(s,this),ne(s,this)),C&&w.attr("title",C),J.trigger("render_cell.jstree-grid",[{value:o,column:T.header,node:s,sourceName:T.value}])}f.addClass("jstree-grid-cell-last"+(X?" ui-state-default":"")),void 0===Q[Q.length-1].width&&f.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}});