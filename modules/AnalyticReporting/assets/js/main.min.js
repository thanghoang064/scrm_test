/*! AnalyticReporting 19-07-2018 */
function capitalize(a){return a&&a[0].toUpperCase()+a.slice(1)}function pop_include_details(){newwindow2=window.open("","name","height=300,width=600");var a=newwindow2.document;a.write("<html><head><title>Include Details Help</title>"),a.write("</head><body>"),a.write("<p>"+translated_labels.label_tooltip_msg_1+"</p>"),a.write("</body></html>"),a.close()}function pop_crosstab(){newwindow2=window.open("","name","height=300,width=600");var a=newwindow2.document;a.write("<html><head><title>Is Crosstab Help</title>"),a.write("</head><body>"),a.write("<p>"+translated_labels.label_tooltip_msg_2+"</p>"),a.write("</body></html>"),a.close()}function pop_aggregates_as_column(){newwindow2=window.open("","name","height=300,width=600");var a=newwindow2.document;a.write("<html><head><title>Aggregates as column Help</title>"),a.write("</head><body>"),a.write("<p>"+translated_labels.label_tooltip_msg_3+"</p>"),a.write("</body></html>"),a.close()}var postToURL=function(a,b){var c=jQuery("<form/>",{action:a,method:"POST",style:"display: none;"});jQuery.each(b,function(a,b){c.append(jQuery("<input/>",{name:a,value:b,type:"hidden"}))}),c.appendTo("body").submit()},cleanAggregates=function(a){for(var b=0;b<a.length;b++)delete a[b].blocks,delete a[b].availableFields;return a};Ractive.decorators.select2.type.filter={width:"resolve",dropdownAutoWidth:!0};var multiSelectDecorator=function(a,b){var c,d,e=a._ractive.root,f=!1,g={header:!1,selectedList:1,click:function(){window.setTimeout(function(){jQuery(a).multiselect("refresh")},0)}};if(jQuery(a).multiselect(g),e.observe("disableSelectBox",function(b){b?jQuery(a).multiselect("disable"):jQuery(a).multiselect("enable")},{init:!1}),a._ractive.binding){var h=function(){f||(f=!0,window.setTimeout(function(){jQuery(a).change(),jQuery(a).multiselect("refresh"),f=!1},0))};c=e.observe(a._ractive.binding.keypath,h),d=e.observe("optionGroups",h)}return jQuery(a).multiselect(g).on("change",function(){f||(f=!0,e.updateModel(),f=!1)}),{teardown:function(){jQuery(a).multiselect("destroy"),c&&(c.cancel(),d.cancel())}}},selectBoxCache={},selectBox=Ractive.extend({template:function(a){if(void 0===selectBoxCache[a.valueName+"|"+a.titleName+"|"+a.addDecorator]){var b="";a.addDecorator&&""!=a.addDecorator&&(b='decorator="'+a.addDecorator+'"'),selectBoxCache[a.valueName+"|"+a.titleName]=Ractive.parse("<select "+b+' value="{{selected}}" disabled="{{readOnly}}">{{#options}}<option value="{{'+a.valueName+'}}" title="{{'+a.descriptionName+'}}">{{'+a.titleName+"}}</option>{{/options}}</select>")}return selectBoxCache[a.valueName+"|"+a.titleName]},oncomplete:function(){var a=this.get();if(a.autoSelectFirst){var b=this,c=function(c){for(var d=!1,e=0;e<c.length;e++)if(c[e][a.valueName]==a.selected){d=!0;break}!d&&c.length>0&&b.set("selected",a.options[0][a.valueName])};c(a.options),this.observe("options",c,{init:!1})}},data:{selected:null,options:[],titleName:"",valueName:"",descriptionName:"",addDecorator:"",autoSelectFirst:!0,readOnly:!1},modifyArrays:!1}),selectBoxImg=Ractive.extend({template:"#selectBoxImgTemplate",oncomplete:function(){var a=!1,b=this.get("autoSelect"),c=this.get("selected"),d=this.get("options"),e=this.get("valueName");b&&""===c&&this.set("selected",d[0][e]);var f=this.find("select"),g=this;jQuery(f).ddslick({width:250,height:300,background:"transparent",imagePosition:"left",onSelected:function(b){if(a){for(var c=0,d=ReportData.selectedAggregates.length-1;d>=0;d--){var e;for(e in aggregatesDefinitions)ReportData.selectedAggregates[d].value[e]&&c++}"Combined"!=b.selectedData.text||ReportData.fieldGroupingSorting.length>0&&c>1?(g.get("selected")!=b.selectedData.value&&jQuery("#ar-rv-chart-editor-tabs").tabs("option","active",1),g.set("selected",b.selectedData.value)):alert(translated_labels.label_chart_error)}}}),setTimeout(function(){for(var b=0,c=ReportData.selectedAggregates.length-1;c>=0;c--){var d;for(d in aggregatesDefinitions)ReportData.selectedAggregates[c].value[d]&&b++}0==ReportData.fieldGroupingSorting.length||b<2?(jQuery(".dd-options").children()[3].style.backgroundColor="lightgrey;",jQuery(".dd-options").children()[3].children[0].backgroundColor="lightgrey;"):(jQuery(".dd-options").children()[3].backgroundColor="white;",jQuery(".dd-options").children()[3].children[0].backgroundColor="white;"),a=!0},3e3)},data:{options:[],selected:"",autoSelect:!0,id:""}}),multiSelectBox=Ractive.extend({template:"#multiSelectBoxTemplate",oninit:function(){},oncomplete:function(){var a=this,b=function(){var b=a.get("selected"),c=a.getDisabledValues(b),d=a.get("options"),e=a.convertData(d,"key","values","name","title",c,b),f=!1;JSON.stringify(e.options)!==JSON.stringify(a.get("optionGroups"))&&(f=!0),a.set("optionGroups",e.options).then(function(){if(JSON.stringify(e.selected)===JSON.stringify(a.get("selected")))return!0;f=!0}).then(function(){f&&setTimeout(function(){a.fire("selectChanged")},10)})};this.observe("options",b,{init:!1}),this.observe("selected",function(a){this.data.selected=a,b()},{init:!1}),b()},getDisabledValues:function(a){for(var b=this.get("aggregates"),c=this.get("groups"),d=[],e=!1,f=!1,g=0;g<a.length;g++){if(c.length>0)for(var h=0;h<c.length;h++)if(a[g]==c[h].name){e=!0;break}if(ReportData.options.isCombined&&"date_field"==a[g]){e=!0;break}if(b.length>0)for(var h=0;h<b.length;h++){var i;for(i in aggregatesDefinitions)if(b[h].value[i]&&a[g]==b[h].selectedField+aggregatesDefinitions[i].namePostfix){f=!0;break}if(f)break}}if(e){for(var g=0;g<b.length;g++){var i;for(i in aggregatesDefinitions)b[g].value[i]&&d.push(b[g].selectedField+aggregatesDefinitions[i].namePostfix)}for(var g=0;g<a.length;g++){for(var h=0;h<c.length;h++)a[g]!=c[h].name&&d.push(c[h].name);ReportData.options.isCombined&&"date_field"!=a[g]&&d.push("date_field")}}if(f){for(var g=0;g<c.length;g++)d.push(c[g].name);ReportData.options.isCombined&&d.push("date_field")}return d},convertData:function(a,b,c,d,e,f,g){for(var h=[],i=[],j=0;j<a.length;j++){for(var k=[],l=0;l<a[j][c].length;l++){var m=!1;-1!==jQuery.inArray(a[j][c][l][d],f)&&(m=!0);m||-1===jQuery.inArray(a[j][c][l][d],g)||(!0,i.push(a[j][c][l][d])),k.push({value:a[j][c][l][d],title:a[j][c][l][e],disabled:m})}h.push({title:a[j][b],items:k})}return h={options:h,selected:i}},decorators:{multiSelect:multiSelectDecorator},data:{options:[],selected:"",optionGroups:[],disabledValues:[],disabledSelectBox:!1,groups:[],aggregates:[]}}),reportUtils={appendDateGrouping:function(a,b){return void 0===a.cols[b]&&(void 0!==a.cols[b+"_year"]?b+="_year":void 0!==a.cols[b+"_quarter"]?b+="_quarter":void 0!==a.cols[b+"_quarterAndYear"]?b+="_quarterAndYear":void 0!==a.cols[b+"_month"]?b+="_month":void 0!==a.cols[b+"_monthAndYear"]?b+="_monthAndYear":void 0!==a.cols[b+"_week"]?b+="_week":void 0!==a.cols[b+"_weekAndYear"]?b+="_weekAndYear":void 0!==a.cols[b+"_day"]&&(b+="_day")),b},generateFieldsByNameFromBlocks:function(a){for(var b={},c=0;c<a.length;c++)for(var d=0;d<a[c].fields.length;d++)b[a[c].fields[d].name]=a[c].fields[d];return b},isMultiSummaryReport:function(a,b,c,d){d=d||!1;for(var e=[],f=0;f<b.length;f++){var g=b[f],h=g.showAggregates;if("column"!=g.position||!d)for(var i=0;i<a.length;i++){var j=h[a[i].selectedField];if(j){var k,l=!1;for(k in aggregatesDefinitions)j[k]&&(l=!0);l&&e.push(!0)}}}return c||e.pop(),e.length>0},convertToJSONPost:function(a,b){var c={};b=b||[];for(var d=Object.keys(a),e=0;e<d.length;e++)-1==b.indexOf(d[e])?c[d[e]]=JSON.stringify(a[d[e]]):c[d[e]]=a[d[e]];return c},getAvailableGroups:function(a,b,c){for(var d=[],e=0;e<b.length;e++)if(-1!=["group","groupsort","nogroup"].indexOf(b[e].sortAction)){var f=jQuery.extend(!0,{},b[e]),g=f.aggregate;f.title=f.fieldLabel,c[g]&&(f.title=c[g].title),f.dateGrouping&&(f.title+=" "+a.dictionary["label_"+reportUtils.toSnakeCase(f.dateGrouping)],f.name=g+"_"+f.dateGrouping),d.push(f)}return a.options.isCombined&&d.unshift({name:"date_field",title:a.dictionary.label_date,showAggregates:{},sortAction:"group",sortDirection:"DESC",aggregate:"",position:"",dateGrouping:""}),d=_.uniq(d,function(a){return a.name})},makeAvailableFields:function(a){for(var b=[],c=0;c<a.length;c++)for(var d=0;d<a[c].fields.length;d++)b.push(a[c].fields[d]);return b},makeFieldsByName:function(a){for(var b={},c=0;c<a.length;c++)for(var d=0;d<a[c].fields.length;d++)b[a[c].fields[d].name]=a[c].fields[d];return b},getAggregate:function(a,b){for(var c=!1,d=0;d<b.length;d++){var e;for(e in aggregatesDefinitions)b[d].value[e]&&b[d].selectedField+aggregatesDefinitions[e].namePostfix==a&&(c=!0);if(c)return b[d]}},getGroup:function(a,b){for(var c=0;c<b.length;c++){var d=b[c].name;if(b[c].dateGrouping&&(d+="_"+b[c].dateGrouping),d==a||b[c].name==a)return b[c]}},findKey:function(a,b){for(var c in a)if(a[c]==b)return c;return null},unique:function(a){var b=[];return jQuery.each(a,function(a,c){-1==jQuery.inArray(c,b)&&b.push(c)}),b},toSnakeCase:function(a){return a.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})},toTitleCase:function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},setFieldsByName:function(){if(ReportData.options.isCombined){for(var a=0;a<ReportData.availableFields.length;a++)for(var b=0;b<ReportData.availableFields[a].fields.length;b++)ReportData.availableFields[a].fields[b].moduleId=ReportData.availableFields[a].fields[b].name.split("_")[0];for(var a=0;a<ReportData.selectableFields.length;a++)for(var b=0;b<ReportData.selectableFields[a].fields.length;b++)ReportData.selectableFields[a].fields[b].moduleId=ReportData.selectableFields[a].fields[b].name.split("_")[0];ReportData.fieldGroupingSorting=ReportData.fieldGroupingSorting.filter(function(a){return void 0!==a.showAggregates})}var c=[];return void 0!==ReportData.options.isCombined&&(ReportData.options.isCombined?(c=reportUtils.makeAvailableFields(ReportData.selectableFields),ReportData.fieldsByName=reportUtils.makeFieldsByName(ReportData.selectableFields)):(c=reportUtils.makeAvailableFields(ReportData.availableFields),ReportData.fieldsByName=reportUtils.makeFieldsByName(ReportData.availableFields))),c}},NumberFormatter=function(a,b){var c=jQuery.extend({},{format:"",seperator:"'",decimal:".",numdec:currentUser.numberPreferences.currencySignificantDigits},a);this.format=c.format,this.decimal=c.decimal,this.seperator=c.seperator,this.aggregates=b,this.numdec=c.numdec,this.integerFields=this.getIntegerFields(),this.integerAggregates=this.getIntegerAggregates()};NumberFormatter.prototype.format="",NumberFormatter.prototype.decimal=".",NumberFormatter.prototype.seperator="'",NumberFormatter.prototype.makeFormatter=function(){var a=this;switch(this.format){case"123,456,789":return function(b,c,d,e,f){try{a.validateNumber(d)}catch(a){return d||""}return d=a.roundByType(d,e,f),a.by3Formatter(d)};case"12,34,56,789":return function(b,c,d,e,f){try{a.validateNumber(d)}catch(a){return d||""}return d=a.roundByType(d,e,f),a.by3then2Formatter(d)};case"123456,789":return function(b,c,d,e,f){try{a.validateNumber(d)}catch(a){return d||""}return d=a.roundByType(d,e,f),a.first3Formatter(d)};case"123456789":default:return function(b,c,d,e,f){try{a.validateNumber(d)}catch(a){return d||""}return d=a.roundByType(d,e,f),a.noFormatter(d)}}},NumberFormatter.prototype.changeDecimalSymbol=function(a){var b="";return a.length>1&&(b=this.decimal+a[1]),b},NumberFormatter.prototype.validateNumber=function(a){if(null==a)throw"";if(!this.isNumber(a))throw a;if(a.length&&!a[0].match("[0-9]"))throw a},NumberFormatter.prototype.by3Formatter=function(a){var b=a.split("."),c=this.changeDecimalSymbol(b);return b[0].length>3&&(b[0]=this.by3(b[0])),b[0]+c},NumberFormatter.prototype.by3then2Formatter=function(a){var b=a.split("."),c=this.changeDecimalSymbol(b);return b[0].length>3&&(b[0]=this.by3then2(b[0])),b[0]+c},NumberFormatter.prototype.first3Formatter=function(a){var b=a.split("."),c=this.changeDecimalSymbol(b);return b[0].length>3&&(b[0]=this.first3(b[0])),b[0]+c},NumberFormatter.prototype.noFormatter=function(a){var b=a.split("."),c=this.changeDecimalSymbol(b);return b[0].length>3&&(b[0]=this.noFormat(b[0])),b[0]+c},NumberFormatter.prototype.separator=function(){var a=this;switch(this.format){case"123,456,789":return function(b,c,d,e,f){try{a.validateNumber(d)}catch(a){return d||""}return a.by3Formatter(String(d))};case"12,34,56,789":return function(b,c,d,e,f){try{a.validateNumber(d)}catch(a){return d||""}return a.by3then2Formatter(String(d))};case"123456,789":return function(b,c,d,e,f){try{a.validateNumber(d)}catch(a){return d||""}return a.first3Formatter(String(d))};case"123456789":default:return function(b,c,d,e,f){try{a.validateNumber(d)}catch(a){return d||""}return a.noFormatter(String(d))}}},NumberFormatter.prototype.noFormat=function(a){return a},NumberFormatter.prototype.by3=function(a){for(var b=a.split("").reverse(),c=[],d=1;d<b.length;d++)c.push(b[d-1]),d%3==0&&c.push(this.seperator);return c.push(b[b.length-1]),c.reverse().join("")},NumberFormatter.prototype.by3then2=function(a){for(var b=a.split("").reverse(),c=[],d=1;d<b.length&&d<4;d++)c.push(b[d-1]),d%3==0&&c.push(this.seperator);for(var d=4;d<b.length;d++)c.push(b[d-1]),d-4&&(d-1)%2==0&&c.push(this.seperator);return c.push(b[b.length-1]),c.reverse().join("")},NumberFormatter.prototype.first3=function(a){var b=a.split(""),c=b.splice(-3,3);return b.length>0&&(c=b.join("")+this.seperator+c.join("")),c},NumberFormatter.prototype.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},NumberFormatter.prototype.isCountAggregate=function(a,b){var c=a.substr(a.lastIndexOf("_")+1),d=["sum","min","max","avg"];if("cnt"==c||"countDistinct"==c)return!0;if(d.indexOf(c)>-1)return!1;if(void 0!==b&&ReportData.options.aggregateColumn)return!!b.aggregates&&0==b.aggregates.indexOf("Count(");for(var e=0;e<ReportData.selectedAggregates.length;e++)if(a.indexOf(ReportData.selectedAggregates[e].selectedField)>-1)return ReportData.selectedAggregates[e].value.count;return!1},NumberFormatter.prototype.getIntegerFields=function(){for(var a=[],b=0;b<ReportData.availableFields.length;b++)for(var c=0;c<ReportData.availableFields[b].fields.length;c++)"integer"==ReportData.availableFields[b].fields[c].type&&a.push(ReportData.availableFields[b].fields[c].name);return a},NumberFormatter.prototype.getIntegerAggregates=function(){for(var a=[],b=0;b<ReportData.selectedAggregates.length;b++){var c=ReportData.selectedAggregates[b];this.integerFields.indexOf(c.selectedField)>-1&&(c.value.sum&&a.push(ReportData.labels[c.selectedField+"_sum"]),c.value.max&&a.push(ReportData.labels[c.selectedField+"_max"]),c.value.min&&a.push(ReportData.labels[c.selectedField+"_min"]))}return a},NumberFormatter.prototype.isIntegerType=function(a,b){if(void 0!==b&&ReportData.options.aggregateColumn)return this.integerAggregates.indexOf(b.aggregates)>-1;for(var c=0;c<this.integerFields.length;c++)if(a.indexOf("_avg")<0&&a.indexOf(this.integerFields[c])>-1)return!0},NumberFormatter.prototype.roundByType=function(a,b,c){return void 0!==b&&(this.isCountAggregate(b.field,c)||this.isIntegerType(b.field,c))&&"avg"!=c?(Math.round(100*parseFloat(a))/100).toFixed(0):Number(Math.round(a+"e+"+this.numdec)+"e-"+this.numdec).toFixed(this.numdec)};var validateXAxis=function(a){for(var b=this.get("getAvailableGroups"),c=!1,d=0;d<b.length;d++)if(a==b[d].name){c=!0;break}var e=a;c||b.length>0&&(e=b[0].name,this.set("xAxis",e)),ReportData.chartAxisX=e};String.prototype.endsWith||(String.prototype.endsWith=function(a,b){return(void 0===b||b>this.length)&&(b=this.length),this.substring(b-a.length,b)===a});var reportBtn=Ractive.extend({template:'<a href="javascript:void(0);" class="ar-button {{className}}" on-click="clicked">{{text}}</a>',data:{text:"",className:""}}),reportBtnGC=Ractive.extend({template:'<a href="javascript:void(0);" on-click="clicked" class="tooltipX"><img src="modules/AnalyticReporting/assets/img/cross_g.png"/><span>{{text}}</span></a>',data:{text:""}}),includeDetails=Ractive.extend({template:'<label style="vertical-align:middle;"><input class="includeDetailsCheckbox" type="checkbox" on-change="changed" checked="{{checked}}" /> {{text}}</label> (<a onclick="pop_include_details();" class="tooltipX" href="#">?<span>'+translated_labels.label_tooltip_msg_1+"</span></a>)",oninit:function(){var a=this;this.observe("checked",function(a){ReportData.options.includeDetails=a,jQuery("body").trigger("includedDetails")}),jQuery("body").on("includedDetails",function(){a.set("checked",ReportData.options.includeDetails)}),this.observe("isCrosstab",function(b){1==ReportData.options.isCrosstab&&a.set("checked",!1)})},data:{text:translated_labels.label_include_details,checked:ReportData.options.includeDetails}}),isCrosstab=Ractive.extend({template:'<label style="vertical-align:middle;"><input id="isCrosstabCheckbox" type="checkbox" checked="{{val}}" /> {{text}}</label> (<a onclick="pop_crosstab();" class="tooltipX" href="#">?<span>'+translated_labels.label_tooltip_msg_2+'</span></a>) {{#val}}<label style="vertical-align:middle;"><input type="checkbox" checked="{{aggregatesAsColumnVal}}" /> {{textCol}}</label>\x3c!-- (<a onclick="pop_aggregates_as_column();" class="tooltipX" href="#">?<span>'+translated_labels.label_tooltip_msg_3+'</span></a>)--\x3e<label style="vertical-align:middle;"><input type="checkbox" checked="{{emptyAsZero}}" /> {{textZero}}</label>{{/val}}',oninit:function(){var a=this;this.observe("val",function(a){ReportData.options.isCrosstab=a,a?(ReportData.options.includeDetails=!1,jQuery("body").trigger("includedDetails")):(this.set("aggregatesAsColumnVal",!1),this.set("emptyAsZero",!1))}),this.observe("aggregatesAsColumnVal",function(a){ReportData.options.aggregateColumn=a}),this.observe("emptyAsZero",function(a){ReportData.options.emptyAsZero=a}),jQuery("body").on("includedDetails",function(){1==ReportData.options.includeDetails&&a.set("val",!1)})},data:{text:translated_labels.label_is_crosstab,textCol:translated_labels.label_aggregates_as_column,textZero:translated_labels.label_empty_as_zero,val:ReportData.options.isCrosstab,aggregatesAsColumnVal:!!ReportData.options.aggregateColumn&&ReportData.options.aggregateColumn}}),reportButtons=Ractive.extend({template:"#reportButtonsTemplate",components:{reportBtn:reportBtn}}),reportButtonPreview=Ractive.extend({template:'<reportBtn text="'+translated_labels.label_preview+'" on-clicked="preview" className="green"/> <img class="ar-loading" src="modules/AnalyticReporting/assets/css/select2-spinner.gif" alt="Loading..." />',components:{reportBtn:reportBtn}}),SaveDataAs=Ractive.extend({el:jQuery("#modalWindow"),append:!1,template:"{{>modalContent}}",data:{},oninit:function(){data=this.get(),jQuery("#modalWindow").dialog({modal:!0,draggable:!1,resizable:!1,title:translated_labels.label_save_report_as,buttons:[{text:translated_labels.label_save,click:function(){var a=this,b=jQuery(this).find("[name=reportName]").val(),c=jQuery(this).find("[name=reportDescription]").val(),d=jQuery(this).find("[name=reportFolder]").val();data.title=b,data.description=c,data.reportFolder=d,jQuery.post(ReportData.saveUrl+ReportData.id,data,function(b){b=JSON.parse(b),ReportData.id=b.id,jQuery(a).dialog("close"),window.location="index.php?module=AnalyticReporting&action=report&record="+ReportData.id})}},{text:translated_labels.label_cancel,click:function(){jQuery(this).dialog("close")}}]})}}),EditTitle=Ractive.extend({el:jQuery("#modalWindow"),append:!1,template:"{{>modalContent}}",data:{},oninit:function(){var a=this.get();jQuery("#modalWindow").dialog({modal:!0,draggable:!1,resizable:!1,title:"   ",buttons:[{text:translated_labels.label_save,click:function(){var b=jQuery(this).find("[name=reportName]").val(),c=jQuery(this).find("[name=reportDescription]").val();a.title=b,a.description=c,a.changeTitle=1,jQuery("#reportTitle").text(b),jQuery("#reportDescription").text(c),jQuery(this).dialog("close"),jQuery.post(ReportData.saveUrl+ReportData.id,a,function(){})}},{text:translated_labels.label_cancel,click:function(){jQuery(this).dialog("close")}}]})}}),AddToDashboard=Ractive.extend({el:jQuery("#modalWindow"),append:!1,template:"#addToDashboardModal",data:{},oninit:function(){jQuery("#modalWindow").dialog({minWidth:420,modal:!0,draggable:!1,resizable:!1,title:translated_labels.label_add_to_dashboard,buttons:[{text:translated_labels.label_add_to_dashboard,click:function(){var a={reportID:ReportData.id,chartTitle:ReportData.chartTitle},b=jQuery(this).find("[name=chosenRoleID]").val(),c=jQuery(this).find("[name=addType]:checked").val();a.chosenRoleID=b,a.addType=c,jQuery(this).dialog("close"),jQuery.post(ReportData.addToDashboardUrl,a,function(){alert(translated_labels.label_chart_added_to_dashboard)})}},{text:translated_labels.label_cancel,click:function(){jQuery(this).dialog("close")}}]})}}),reportAccessRights=Ractive.extend({template:'<selectBox selected="{{level}}" options="{{rights}}" titleName="title" valueName="name" />',data:{rights:[{name:"VIEW",title:translated_labels.label_can_view},{name:"EDIT",title:translated_labels.label_can_edit},{name:"DELETE",title:translated_labels.label_can_delete}],level:"VIEW"},components:{selectBox:selectBox}}),reportAccessManager=Ractive.extend({template:"#reportAccessTemplate",onconstruct:function(a){for(var b={},c=[],d=0;d<a.data.users.length;d++)b[a.data.users[d].id]=a.data.users[d],void 0!==a.data.accessRights[a.data.users[d].id]?(b[a.data.users[d].id].accessRights=a.data.accessRights[a.data.users[d].id],b[a.data.users[d].id].selected=!0,c.push(a.data.users[d].id)):b[a.data.users[d].id].accessRights="VIEW";a.data.selectedUsers=c,a.data.usersById=b},oninit:function(){var a=this;this.on("selectUsers",function(b,c){for(var d=a.get("selectedUsers"),e=0;e<c.length;e++)d.push(c[e]),a.set("usersById."+c[e]+".selected",!0);a.set("selectedUsers",d),a.set("updatePermissions",!0)}),this.on("removeUser",function(b,c){var d=a.get("selectedUsers"),e=d.indexOf(c);d.splice(e,1),a.set("usersById."+c+".selected",!1),a.set("selectedUsers",d)}),this.on("cleanFilter",function(a){a.original.preventDefault(),this.set("filter","")}),this.observe("globalSharing",function(b){if("PUB"===b){for(var c=a.get("selectedUsers"),d=0;d<c.length;d++)a.set("usersById."+c[d]+".selected",!1);a.set("selectedUsers",c)}},{init:!1}),this.observe("allowDrilldownReadOnly",function(a){ReportData.options.allowDrilldownReadOnly=a}),this.observe("allowExportReadOnly",function(a){ReportData.options.allowExportReadOnly=a})},data:{users:[],selectedUsers:[],usersById:{},filter:"",accessRights:{},globalSharing:"PRIV",availableOwners:[],updatePermissions:!1,owner:0,canEdit:!1,canDelete:!1,allowDrilldownReadOnly:!0,allowExportReadOnly:!0},getSelectedAccess:function(){for(var a=this.get("selectedUsers"),b=this.get("usersById"),c={},d=0;d<a.length;d++)void 0!==typeof b[a[d]].selected&&b[a[d]].selected&&(c[a[d]]=b[a[d]].accessRights);return c},computed:{filteredUsers:function(){var a=this.get("filter").toLowerCase(),b=this.get("usersById"),c={};for(key in b)b.hasOwnProperty(key)&&b[key].name.toLowerCase().match(a)&&(c[key]=b[key]);return c}},components:{reportAccessRights:reportAccessRights,reportButtons:reportButtons,reportButtonPreview:reportButtonPreview,selectBox:selectBox}}),reportScheduleManager=Ractive.extend({template:"#reportSchedulingTemplate",onconstruct:function(a){for(var b={},c=0;c<a.data.users.length;c++)b[a.data.users[c].id]=a.data.users[c],a.data.selectedUsers.indexOf(a.data.users[c].id)>-1?(b[a.data.users[c].id].selected=!0,"e"==a.data.users[c].id.charAt(0)&&(this.data.emails[a.data.users[c].id]=a.data.users[c].name.replace(translated_labels.label_email+"::",""))):b[a.data.users[c].id].selected=!1;a.data.usersById=b},oninit:function(){var a=this;this.on("selectUsers",function(b,c){b.original.preventDefault();for(var d=a.get("selectedUsers"),e=0;e<c.length;e++)d.push(c[e]),a.set("usersById."+c[e]+".selected",!0);a.set("selectedUsers",d),a.set("isScheduled",!0)}),this.on("addCustomEmail",function(b,c){if(b.original.preventDefault(),/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(c)){for(var d=a.get("selectedUsers"),e=a.get("usersById");"e_"+this.data.emailcounter in this.data.emails;)this.data.emailcounter++;var f={id:"e_"+this.data.emailcounter++,name:"Email::"+c,selected:!0};this.data.emails[f.id]=c,e[f.id]=f,d.push(f.id),a.set("usersById",e),a.set("selectedUsers",d),a.set("isScheduled",!0)}else alert(translated_labels.label_invalid_email)}),this.on("removeUser",function(b,c){b.original.preventDefault();var d=a.get("selectedUsers"),e=d.indexOf(c);if(d.splice(e,1),"e"==c.charAt(0)){var f=a.get("usersById");delete f[c],a.set("usersById",f),delete a.data.emails[c]}else a.set("usersById."+c+".selected",!1);a.set("selectedUsers",d)}),this.on("cleanFilter",function(a){a.original.preventDefault(),this.set("filter","")});var b=function(b){var c=a.get("interval"),d=["02","04","06","09","11"];4==c&&(d.indexOf(b)>-1?"02"==b?a.set("days",[{val:"01",title:"1"},{val:"02",title:"2"},{val:"03",title:"3"},{val:"04",title:"4"},{val:"05",title:"5"},{val:"06",title:"6"},{val:"07",title:"7"},{val:"08",title:"8"},{val:"09",title:"9"},{val:"10",title:"10"},{val:"11",title:"11"},{val:"12",title:"12"},{val:"13",title:"13"},{val:"14",title:"14"},{val:"15",title:"15"},{val:"16",title:"16"},{val:"17",title:"17"},{val:"18",title:"18"},{val:"19",title:"19"},{val:"20",title:"20"},{val:"21",title:"21"},{val:"22",title:"22"},{val:"23",title:"23"},{val:"24",title:"24"},{val:"25",title:"25"},{val:"26",title:"26"},{val:"27",title:"27"},{val:"28",title:"28"}]):a.set("days",[{val:"01",title:"1"},{val:"02",title:"2"},{val:"03",title:"3"},{val:"04",title:"4"},{val:"05",title:"5"},{val:"06",title:"6"},{val:"07",title:"7"},{val:"08",title:"8"},{val:"09",title:"9"},{val:"10",title:"10"},{val:"11",title:"11"},{val:"12",title:"12"},{val:"13",title:"13"},{val:"14",title:"14"},{val:"15",title:"15"},{val:"16",title:"16"},{val:"17",title:"17"},{val:"18",title:"18"},{val:"19",title:"19"},{val:"20",title:"20"},{val:"21",title:"21"},{val:"22",title:"22"},{val:"23",title:"23"},{val:"24",title:"24"},{val:"25",title:"25"},{val:"26",title:"26"},{val:"27",title:"27"},{val:"28",title:"28"},{val:"29",title:"29"},{val:"30",title:"30"}]):a.set("days",[{val:"01",title:"1"},{val:"02",title:"2"},{val:"03",title:"3"},{val:"04",title:"4"},{val:"05",title:"5"},{val:"06",title:"6"},{val:"07",title:"7"},{val:"08",title:"8"},{val:"09",title:"9"},{val:"10",title:"10"},{val:"11",title:"11"},{val:"12",title:"12"},{val:"13",title:"13"},{val:"14",title:"14"},{val:"15",title:"15"},{val:"16",title:"16"},{val:"17",title:"17"},{val:"18",title:"18"},{val:"19",title:"19"},{val:"20",title:"20"},{val:"21",title:"21"},{val:"22",title:"22"},{val:"23",title:"23"},{val:"24",title:"24"},{val:"25",title:"25"},{val:"26",title:"26"},{val:"27",title:"27"},{val:"28",title:"28"},{val:"29",title:"29"},{val:"30",title:"30"},{val:"31",title:"31"}]))};this.observe("intervalOptions.0",b),this.observe("interval",function(a){4==a?b(this.get("intervalOptions.0")):3==a&&b("01")})},getSelectedRecipients:function(){for(var a=this.get("selectedUsers"),b=this.get("usersById"),c=[],d=0;d<a.length;d++)b[a[d]]&&void 0!==typeof b[a[d]].selected&&b[a[d]].selected&&c.push(a[d]);return c.push(this.data.emails),c},computed:{filteredUsers:function(){var a=this.get("filter").toLowerCase(),b=this.get("usersById"),c={};for(key in b)b.hasOwnProperty(key)&&b[key].name.toLowerCase().match(a)&&(c[key]=b[key]);return c}},data:{users:[],selectedUsers:[],usersById:{},filter:"",emails:{},emailcounter:0,emailpermission:"undefined"!=typeof current_user&&(1==current_user.is_admin||ReportData.owner==current_user.id),isScheduled:!1,interval:0,intervalOptions:[],timeM:"00",timeH:"00",minutes:[{m:"00"},{m:"05"},{m:"10"},{m:"15"},{m:"20"},{m:"25"},{m:"30"},{m:"35"},{m:"40"},{m:"45"},{m:"50"},{m:"55"}],hours:[{h:"00"},{h:"01"},{h:"02"},{h:"03"},{h:"04"},{h:"05"},{h:"06"},{h:"07"},{h:"08"},{h:"09"},{h:"10"},{h:"11"},{h:"12"},{h:"13"},{h:"14"},{h:"15"},{h:"16"},{h:"17"},{h:"18"},{h:"19"},{h:"20"},{h:"21"},{h:"22"},{h:"23"}],weekdays:[{val:"0",title:translated_labels.label_monday},{val:"1",title:translated_labels.label_tuesday},{val:"2",title:translated_labels.label_wednesday},{val:"3",title:translated_labels.label_thursday},{val:"4",title:translated_labels.label_friday},{val:"5",title:translated_labels.label_saturday},{val:"6",title:translated_labels.label_sunday}],monthweeks:[{val:0,title:translated_labels.label_week_first_third},{val:1,title:translated_labels.label_week_second_fourth}],months:[{val:"01",title:"1"},{val:"02",title:"2"},{val:"03",title:"3"},{val:"04",title:"4"},{val:"05",title:"5"},{val:"06",title:"6"},{val:"07",title:"7"},{val:"08",title:"8"},{val:"09",title:"9"},{val:"10",title:"10"},{val:"11",title:"11"},{val:"12",title:"12"}],days:[{val:"01",title:"1"},{val:"02",title:"2"},{val:"03",title:"3"},{val:"04",title:"4"},{val:"05",title:"5"},{val:"06",title:"6"},{val:"07",title:"7"},{val:"08",title:"8"},{val:"09",title:"9"},{val:"10",title:"10"},{val:"11",title:"11"},{val:"12",title:"12"},{val:"13",title:"13"},{val:"14",title:"14"},{val:"15",title:"15"},{val:"16",title:"16"},{val:"17",title:"17"},{val:"18",title:"18"},{val:"19",title:"19"},{val:"20",title:"20"},{val:"21",title:"21"},{val:"22",title:"22"},{val:"23",title:"23"},{val:"24",title:"24"},{val:"25",title:"25"},{val:"26",title:"26"},{val:"27",title:"27"},{val:"28",title:"28"},{val:"29",title:"29"},{val:"30",title:"30"},{val:"31",title:"31"}],intervalAvailableValues:[{value:0,title:translated_labels.label_daily},{value:1,title:translated_labels.label_weekly},{value:2,title:translated_labels.label_biweekly},{value:3,title:translated_labels.label_monthly},{value:4,title:translated_labels.label_yearly}],scheduledFormats:{xlsx:!1,pdf:!1,url:!1}},components:{selectBox:selectBox}});